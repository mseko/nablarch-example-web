<?xml version="1.0" encoding="UTF-8"?>
<component-configuration
        xmlns="http://tis.co.jp/nablarch/component-configuration"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://tis.co.jp/nablarch/component-configuration https://nablarch.github.io/schema/component-configuration.xsd">

  <!-- プロダクションのコンポーネント設定を読み込む -->
  <import file="web-component-configuration.xml"/>

  <!-- テスティングフレームワークの設定 -->
  <import file="nablarch/test/master-data-restorer.xml"/>
  <import file="nablarch/test/test-data.xml"/>
  <import file="nablarch/test/test-transaction.xml"/>
  <import file="nablarch/test/http-request-test.xml"/>

  <!-- メインを上書きする設定-->
  <import file="override_test.xml"/>

  <!-- HTML5の仕様で記述しているため既存のHTMLチェッカを外す -->
  <component name="httpTestConfiguration" class="nablarch.test.core.http.HttpTestConfiguration">
    <property name="checkHtml" value="false" />
  </component>

  <!-- DBの接続設定を定義する -->
  <component name="dbInfo" class="nablarch.test.core.db.GenericJdbcDbInfo">
    <property name="dataSource" ref="dataSource"/>
    <property name="schema" value="PUBLIC"/>
  </component>

  <!-- テスト用HttpServerにJetty6を定義する -->
  <component name="httpServerFactory" class="nablarch.fw.web.httpserver.HttpServerFactoryJetty6"/>
  
  <!-- ハンドラキュー構成 -->
  <component name="webFrontController"
             class="nablarch.fw.web.servlet.WebFrontController">
    <property name="handlerQueue">
      <list>
        <component class="nablarch.fw.web.handler.HttpCharacterEncodingHandler"/>

        <component class="nablarch.fw.handler.GlobalErrorHandler"/>

        <!-- JSPフォワード時にDIコンテナを参照する場合は、HttpResponseHandlerより上に配置する -->
        <component-ref name="nablarchWebContextHandler"/>
        
        <component class="com.nablarch.example.app.test.handler.TestCallbackHandler" />

        <component class="nablarch.fw.web.handler.HttpResponseHandler"/>

        <component class="nablarch.fw.web.handler.SecureHandler" />

        <component-ref name="multipartHandler"/>

        <component-ref name="sessionStoreHandler" />

        <component class="nablarch.fw.web.handler.NormalizationHandler">
          <property name="normalizers">
            <list>
              <component class="nablarch.fw.web.handler.normalizer.TrimNormalizer" />
              <component class="com.nablarch.example.app.web.handler.DateFormatNormalizer" />
            </list>
          </property>
        </component>

        <component class="nablarch.fw.web.handler.ForwardingHandler"/>

        <component class="nablarch.fw.web.handler.HttpErrorHandler" >
          <property name="defaultPages">
            <map>
              <entry key="4.." value="/WEB-INF/view/common/errorPages/userError.jsp" />
              <entry key="403" value="/WEB-INF/view/common/errorPages/permissionError.jsp" />
              <entry key="404" value="/WEB-INF/view/common/errorPages/pageNotFoundError.jsp" />
              <entry key="413" value="/WEB-INF/view/common/errorPages/requestEntityTooLarge.jsp" />
              <entry key="5.." value="/WEB-INF/view/common/errorPages/error.jsp" />
              <entry key="503" value="/WEB-INF/view/common/errorPages/serviceUnavailableError.jsp" />
            </map>
          </property>
        </component>

        <component-ref name="nablarchTagHandler"/>

        <component-ref name="dbConnectionManagementHandler"/>

        <component-ref name="transactionManagementHandler"/>



        <component class="com.nablarch.example.app.web.action.LoginUserPrincipalCheckHandler"/>

        <component class="com.nablarch.example.app.web.handler.ExampleErrorForwardHandler"/>

        <component-ref name="packageMapping"/>
      </list>
    </property>
  </component>

</component-configuration>
